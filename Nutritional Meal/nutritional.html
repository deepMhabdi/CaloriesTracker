<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Recipe Search</title>
<!-- Add any necessary CSS links -->
</head>
<body>

<div class="container">
  <label for="find-recipe">Search Recipe:</label>
  <input type="text" id="find-recipe">
  <button id="search-recipe">Search</button>
  <button id="search-random-recipe">Random Recipe</button>
</div>

<div id="display-recipe">
  <!-- Recipes will be displayed here -->
</div>

<!-- Modal for displaying ingredients -->
<div class="modal" id="show-ingredients">
  <div class="modal-background"></div>
  <div class="modal-content">
    <div class="box">
      <h3 id="show-ingredients-title"></h3>
      <div id="show-ingredients-body"></div>
    </div>
  </div>
  <button class="modal-close is-large" aria-label="close"></button>
</div>

<!-- Add necessary JavaScript libraries and scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Add any other JavaScript files -->
<script>
var app_id = '115c348d';
var api_key = 'e007d5f66ddded2d96d86f71db34eb4f';

var recipeArr = [];
var searchTerm = "";

$(document).ready(function () {
    var searchFunction = function (searchTerm) {
        $("#display-recipe").empty();
        recipeArr = [];

        queryURL = "https://api.edamam.com/search?q=" + searchTerm + "&app_id=" + app_id + "&app_key=" + api_key;
        $.ajax({
            type: "GET",
            url: queryURL,
            success: function (response) {
                response.hits.forEach(function (element, i) {
                    var recipe = element.recipe;
                    var calories = Math.floor(recipe.calories / recipe.yield);
                    var addRecipe = '<div class="tile is-parent">' +
                        '<article class="tile is-child box">' +
                        '<div class="card">' +
                        '<div class="card-image">' +
                        '<figure class="image is-square">' +
                        '<img class="recipe-image" src="' + recipe.image + '" alt="Placeholder image">' +
                        '</figure>' +
                        '</div>' +
                        '<div class="card-content">' +
                        '<div class="content">' +
                        '<h3 class="title">' + recipe.label + '</h3>' +
                        '<p class="calories">' + calories + ' calories per serving.</p><p> Servings: ' + recipe.yield + '</p>' +
                        '<p class="ingredients">' +
                        '<a class="ingredients is-link" data-id=' + i + '>' + recipe.ingredients.length + ' Ingredients</span></p>' +
                        '<br>' +
                        '<p class="subtitle"><a href="' + recipe.url + '" target="_blank">Get the Recipe</a></p>' +
                        '</div>' +
                        '</div>' +
                        '<footer class="card-footer">' +
                        '</footer>' +
                        '</div>' +
                        '</article>' +
                        '</div>';
                    $("#display-recipe").append(addRecipe);
                    var ingredientsArr = [];
                    recipe.ingredients.forEach(element => {
                        ingredientsArr.push(element.text);
                    });
                    var recipeDBinfo = {
                        "image": recipe.image,
                        "title": recipe.label,
                        "caloriesPer": calories,
                        "servings": recipe.yield,
                        "numIngredients": recipe.ingredients.length,
                        "ingredients": ingredientsArr,
                        "url": recipe.url
                    };
                    recipeArr.push(recipeDBinfo);
                });
            }
        });
        $("#find-recipe").val("");
    };

    // Initial search on page load
    searchFunction("");

    $("#search-recipe").on("click", function (e) {
        if ($("#find-recipe").val() !== "") {
            searchTerm = $("#find-recipe").val().trim();
            searchFunction(searchTerm);
        } else {
            return false;
        }
    });

    $("#find-recipe").keypress(function (e) {
        if (e.which == 13) {
            $("#search-recipe").click();
        }
    });

    $(document).on("click", "#search-random-recipe", function () {
        var randomNum = Math.floor(Math.random() * (randomRecipe.length));
        searchTerm = randomRecipe[randomNum];
        searchFunction(searchTerm);
    });

    $(document).on("click", "a.ingredients", function () {
        var ingredientsNum = $(this).data("id");
        $("#show-ingredients-title").text(recipeArr[ingredientsNum].title + " Ingredients");
        $("#show-ingredients-body").empty();
        recipeArr[ingredientsNum].ingredients.forEach(function (ingredient) {
            $("#show-ingredients-body").append("<p>" + ingredient + "</p>");
        });
        $("#show-ingredients").addClass("is-active");
    });

});
</script>

</body>
</html>